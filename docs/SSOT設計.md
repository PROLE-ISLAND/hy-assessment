# SSOTè¨­è¨ˆ - Claude Hooks + Guardrails YAML

> **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: è¨­è¨ˆå®Œäº†ãƒ»å®Ÿè£…å¾…ã¡
> **ä½œæˆæ—¥**: 2026-01-06
> **é–¢é€£**: Claude Code Hooksã€GitHub Actionsã€å“è³ªã‚²ãƒ¼ãƒˆ

## æ¦‚è¦

Claude Code ã® Hook ã‚·ã‚¹ãƒ†ãƒ ã¨ GitHub Actions ã‚’ **Single Source of Truth (SSOT)** ã¨ã—ã¦çµ±åˆã™ã‚‹è¨­è¨ˆã€‚
ãƒ«ãƒ¼ãƒ«å®šç¾©ã‚’ YAML ãƒ•ã‚¡ã‚¤ãƒ«ã«é›†ç´„ã—ã€äºŒé‡ç®¡ç†ã‚’æ’é™¤ã™ã‚‹ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SSOT: claude-guardrails.yaml              â”‚
â”‚  (PROLE-ISLAND/.github ãƒªãƒã‚¸ãƒˆãƒªã§ä¸€å…ƒç®¡ç†)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                   â–¼                   â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PreToolUse  â”‚    â”‚ PostToolUse â”‚    â”‚    Stop     â”‚
   â”‚  gate.py    â”‚    â”‚ quality-ts  â”‚    â”‚  dod-check  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                   â”‚                   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ GitHub Actions  â”‚
                    â”‚ (CI/CD æ¤œè¨¼)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

| ãƒ•ã‚¡ã‚¤ãƒ« | å½¹å‰² | é…ç½®å ´æ‰€ |
|---------|------|----------|
| `claude-guardrails.yaml` | ãƒ«ãƒ¼ãƒ«å®šç¾©ï¼ˆSSOTï¼‰ | `~/.claude/cache/` |
| `guardrails_loader.py` | YAMLèª­è¾¼å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª | `~/.claude/hooks/lib/` |
| `gate.py` | PreToolUse Hook | `~/.claude/hooks/` |
| `quality-ts.py` | PostToolUse Hook | `~/.claude/hooks/` |
| `dod-check.py` | Stop Hook | `~/.claude/hooks/` |

## ç’°å¢ƒå¤‰æ•°

| å¤‰æ•°å | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|--------|------|-----------|
| `CLAUDE_GUARDRAILS_PATH` | YAMLãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | `~/.claude/cache/claude-guardrails.yaml` |
| `CLAUDE_DOD_STRICT` | å³æ ¼ãƒ¢ãƒ¼ãƒ‰ï¼ˆ1=æœ‰åŠ¹ï¼‰ | `0` |
| `CLAUDE_QUALITY_CACHE_TTL` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹æœŸé–“ï¼ˆç§’ï¼‰ | `600` |

## Hook æ©Ÿèƒ½ä¸€è¦§

### PreToolUse (gate.py)

| æ¤œè¨¼å¯¾è±¡ | æ©Ÿèƒ½ |
|---------|------|
| `gh issue create` | `--body-file` å¿…é ˆåŒ–ã€å¿…é ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³æ¤œè¨¼ |
| `gh pr create` | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæº–æ‹ ãƒã‚§ãƒƒã‚¯ã€Issue ãƒªãƒ³ã‚¯æ¤œè¨¼ |
| `git commit` | ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼ã€æ©Ÿå¯†æƒ…å ±æ¤œå‡º |
| `git push` | ä¿è­·ãƒ–ãƒ©ãƒ³ãƒã¸ã® force push ç¦æ­¢ |

### PostToolUse (quality-ts.py)

| æ¤œè¨¼å¯¾è±¡ | æ©Ÿèƒ½ |
|---------|------|
| `Edit`, `Write` | TypeScript ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†å¾Œã®å‹ãƒã‚§ãƒƒã‚¯ãƒ»Lint |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ | ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã«ã‚ˆã‚‹è„†å¼±æ€§æ¤œå‡º |

### Stop (dod-check.py)

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| GitçŠ¶æ…‹ç¢ºèª | æœªã‚³ãƒŸãƒƒãƒˆãƒ»æœªãƒ—ãƒƒã‚·ãƒ¥ã®è­¦å‘Š |
| DoD Bronze | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ™ãƒ¼ã‚¹ã®å“è³ªç¢ºèª |
| å³æ ¼ãƒ¢ãƒ¼ãƒ‰ | ãƒ•ãƒ«ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |

## YAML ã‚¹ã‚­ãƒ¼ãƒï¼ˆæŠœç²‹ï¼‰

```yaml
# claude-guardrails.yaml
issue:
  body_method: body-file
  required_sections:
    - name: "## ğŸ“‹ äº‹å‰èª¿æŸ»"
      required: true
    - name: "## ğŸ“ æ©Ÿèƒ½å®šç¾©"
      required: true

pr:
  required_sections:
    - id: issue_link
      pattern: "closes #\\d+"

commit:
  types: [feat, fix, docs, style, refactor, test, chore, ci, perf, build]
  secret_patterns:
    - pattern: "(?i)(api[_-]?key|secret|password)\\s*[:=]\\s*['\"][^'\"]{8,}"
      name: "API Key/Secret"
      action: block

push:
  protected_branches: [main, master, develop]

dod:
  bronze:
    requirements:
      - id: A1
        command: "npx tsc --noEmit"
        required: true
      - id: A2
        command: "npm run lint"
        required: true
```

## ä»Šå¾Œã®æ‹¡å¼µ

1. **SessionStart Hook ã§ã®è‡ªå‹•åŒæœŸ**
   - `PROLE-ISLAND/.github` ã‹ã‚‰æœ€æ–° YAML ã‚’å–å¾—
   - ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜

2. **GitHub Actions ã¨ã®å®Œå…¨çµ±åˆ**
   - åŒä¸€ YAML ã‚’ Actions ã§ã‚‚å‚ç…§
   - Hook ã¨ Actions ã§åŒä¸€ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨

## å‚è€ƒãƒªãƒ³ã‚¯

- [Claude Code Hooks ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.anthropic.com/claude-code/hooks)
- [çµ„ç¹”å…±é€šãƒ«ãƒ¼ãƒ« Wiki](https://github.com/PROLE-ISLAND/.github/wiki)
